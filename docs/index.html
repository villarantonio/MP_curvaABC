<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Executivo - Manda Picanha</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root { --primary: #0f172a; --secondary: #3b82f6; --bg: #f8fafc; --card: #ffffff; --text: #334155; --success: #10b981; --danger: #ef4444; --warning: #f59e0b; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background: var(--bg); color: var(--text); padding: 20px; line-height: 1.5; }
        .container { max-width: 1200px; margin: 0 auto; }

        /* Controles */
        .controls { background: var(--card); padding: 15px 20px; border-radius: 12px; display: flex; flex-wrap: wrap; gap: 20px; align-items: center; justify-content: space-between; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .filter-group { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        input[type="month"], select { padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; outline: none; }

        /* Seletor de Lojas */
        .store-selector { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; scrollbar-width: thin; }
        .store-btn { padding: 8px 16px; border: 1px solid #e2e8f0; background: white; border-radius: 20px; cursor: pointer; white-space: nowrap; transition: 0.2s; font-size: 0.9em; font-weight: 500; color: #64748b; }
        .store-btn.active { background: var(--secondary); color: white; border-color: var(--secondary); box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3); }

        /* Grids e Cards */
        .grid-2 { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 20px; }
        .grid-lists { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); height: 100%; display: flex; flex-direction: column; }
        .card-header { font-size: 1.1em; font-weight: 700; color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid #f1f5f9; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }

        /* Listas */
        .ranking-list { overflow-y: auto; max-height: 400px; padding-right: 5px; }
        .ranking-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #f8fafc; font-size: 0.95em; }
        .ranking-item:last-child { border-bottom: none; }
        .item-rank { font-weight: bold; color: #94a3b8; width: 30px; }
        .item-name { flex-grow: 1; margin-right: 10px; font-weight: 500; }
        .item-val { font-weight: 700; }

        /* Tags */
        .mini-tag { font-size: 0.75em; background: #fef3c7; color: #d97706; padding: 2px 6px; border-radius: 4px; margin-left: 5px; display: inline-block; }
        .abc-tag { font-size: 0.75em; padding: 2px 6px; border-radius: 4px; margin-right: 5px; font-weight: bold; color: white; }
        .tag-a { background-color: var(--success); }
        .tag-b { background-color: var(--warning); }
        .tag-c { background-color: var(--danger); }

        /* Insights */
        .insight-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .insight-card { background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; transition: 0.2s; border-left: 4px solid var(--warning); }
        .insight-prod { font-weight: 700; color: var(--primary); margin-bottom: 8px; font-size: 1em; }
        .insight-text { font-size: 0.9em; color: #475569; line-height: 1.5; background: #fffbeb; padding: 8px; border-radius: 6px; }
        .insight-action { margin-top: 8px; font-size: 0.85em; color: var(--secondary); font-weight: 600; display: flex; align-items: center; gap: 5px; }

        /* Granularidade */
        .granularity-btns { display: flex; gap: 5px; }
        .granularity-btn { padding: 8px 14px; border: 1px solid #e2e8f0; background: white; border-radius: 6px; cursor: pointer; font-size: 0.85em; font-weight: 500; color: #64748b; transition: 0.2s; }
        .granularity-btn.active { background: var(--secondary); color: white; border-color: var(--secondary); }

        /* Loading */
        .loading { text-align: center; padding: 40px; }
        .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid var(--secondary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-msg { background: #fef2f2; color: var(--danger); padding: 20px; border-radius: 8px; text-align: center; }

        @media (max-width: 768px) { .grid-2, .grid-lists, .insight-grid { grid-template-columns: 1fr; } .filter-group { flex-direction: column; align-items: stretch; } }
    </style>
</head>
<body>

<div class="container">
    <div id="loading-screen" class="loading">
        <div class="loading-spinner"></div>
        <p>Carregando dados...</p>
    </div>

    <div id="dashboard-panel" style="display: none;">
        <div class="controls">
            <h3 style="color: var(--primary);">üìä Dashboard Executivo - Manda Picanha</h3>
            <div class="filter-group">
                <div class="granularity-btns">
                    <button onclick="setGranularity('diario')" id="btnDiario" class="granularity-btn">üìÖ Di√°rio</button>
                    <button onclick="setGranularity('semanal')" id="btnSemanal" class="granularity-btn">üìÜ Semanal</button>
                    <button onclick="setGranularity('mensal')" id="btnMensal" class="granularity-btn active">üóìÔ∏è Mensal</button>
                </div>
                <label>Per√≠odo:</label>
                <select id="periodSelect" onchange="processData()">
                    <option value="">Selecione...</option>
                </select>
                <button onclick="processData()" style="padding: 8px 16px; background: var(--primary); color: white; border:none; border-radius:6px; cursor:pointer;">üîÑ Atualizar</button>
            </div>
        </div>

        <div class="store-selector" id="storeList"></div>

        <div class="grid-2">
            <div class="card" style="justify-content: flex-start; align-items: center; text-align: center;">
                <div style="font-size: 0.9em; color: #64748b;">Faturamento no Per√≠odo</div>
                <div id="totalFat" style="font-size: 2.5em; font-weight: 800; color: var(--success);">R$ 0,00</div>
                <div id="totalItens" style="margin-top: 10px; font-weight: 500; color: var(--primary); margin-bottom: 20px;">0 produtos</div>

                <div style="width: 100%; border-top: 1px solid #f1f5f9; padding-top: 15px;">
                    <div style="font-size: 0.9em; font-weight: 600; color: #64748b; margin-bottom: 10px;">Mix de Produtos (Curva ABC)</div>
                    <div style="height: 180px;"><canvas id="chartABC"></canvas></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">üìà Hist√≥rico de Vendas</div>
                <div style="height: 250px; width: 100%;"><canvas id="chartHistory"></canvas></div>
            </div>
        </div>

        <div class="grid-lists">
            <div class="card">
                <div class="card-header" style="color: var(--success);">
                    üèÜ Top 10 Mais Vendidos
                    <button id="btnRestoreBest" onclick="restoreRankings()" style="display: none; padding: 4px 12px; background: var(--secondary); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.8em;">‚Ü© Restaurar</button>
                </div>
                <div class="ranking-list" id="listBest"></div>
            </div>
            <div class="card">
                <div class="card-header" style="color: var(--danger);">
                    üîª Top 10 Menos Vendidos
                    <button id="btnRestoreWorst" onclick="restoreRankings()" style="display: none; padding: 4px 12px; background: var(--secondary); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.8em;">‚Ü© Restaurar</button>
                </div>
                <div class="ranking-list" id="listWorst"></div>
            </div>
        </div>

        <div class="card" style="margin-top: 30px;">
            <div class="card-header" style="color: var(--warning);">
                üß† Insights da IA
                <span style="font-size: 0.7em; background: #fffbeb; padding: 4px 8px; border-radius: 12px; color: #d97706;" id="insightCount">0 encontrados</span>
            </div>
            <div style="padding: 15px 20px; border-bottom: 1px solid #f1f5f9;">
                <input type="text" id="searchInsights" placeholder="üîç Pesquisar por produto ou diagn√≥stico..."
                       style="width: 100%; padding: 10px 15px; border: 2px solid #e2e8f0; border-radius: 8px; outline: none; font-size: 0.95em;"
                       onkeyup="filterInsights()">
            </div>
            <div id="allInsightsContainer" class="insight-grid" style="padding: 15px;"></div>
        </div>
    </div>

    <div id="error-screen" class="error-msg" style="display: none;">
        <h3>‚ùå Erro ao carregar dados</h3>
        <p id="error-detail">Verifique se os arquivos JSON existem na pasta data/</p>
    </div>
</div>

<script>
    // =======================================================
    // CONFIGURA√á√ÉO - Caminho dos dados
    // =======================================================
    const DATA_PATH = './data/';

    // Estado global
    let JSON_VENDAS = null;
    let GRANULARIDADE = 'mensal';
    let ACTIVE_STORE = null;
    let chartInstance = null;
    let chartABCInstance = null;

    const NOMES_LOJAS = {
        "1": "CD VACA BRAVA", "12": "MP SHOPPING CERRADO", "14": "MP SHOPPING RIO VERDE", "15": "MADALENA GASTROBAR",
        "2": "MP PASSEIO DAS AGUAS", "20": "MALIBU SUSHI BAR", "3": "MP ALPHAMALL", "4": "PETRA BAR",
        "5": "MANDA PIZZA", "6": "MANDA PICANHA MARISTA", "7": "MANDA PIZZA MARISTA", "8": "O SANTO DESCONFIA", "9": "MP STEAK BAR"
    };

    // =======================================================
    // FUN√á√ïES DE CARREGAMENTO DE DADOS (FETCH)
    // =======================================================

    async function loadData(granularidade) {
        const arquivo = `vendas_${granularidade}.json`;
        try {
            const response = await fetch(DATA_PATH + arquivo);
            if (!response.ok) throw new Error(`Arquivo n√£o encontrado: ${arquivo}`);
            return await response.json();
        } catch (error) {
            console.error(`Erro ao carregar ${arquivo}:`, error);
            return null;
        }
    }

    async function setGranularity(tipo) {
        GRANULARIDADE = tipo;

        // Atualiza bot√µes
        document.querySelectorAll('.granularity-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('btn' + tipo.charAt(0).toUpperCase() + tipo.slice(1)).classList.add('active');

        // Mostra loading
        document.getElementById('loading-screen').style.display = 'block';
        document.getElementById('dashboard-panel').style.display = 'none';

        // Carrega dados
        const dados = await loadData(tipo);

        if (dados && dados.dados_lojas) {
            JSON_VENDAS = dados.dados_lojas;
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('dashboard-panel').style.display = 'block';
            initDashboard();
        } else {
            showError(`N√£o foi poss√≠vel carregar os dados ${tipo}. Verifique se o arquivo existe.`);
        }
    }

    function showError(msg) {
        document.getElementById('loading-screen').style.display = 'none';
        document.getElementById('dashboard-panel').style.display = 'none';
        document.getElementById('error-screen').style.display = 'block';
        document.getElementById('error-detail').textContent = msg;
    }

    // =======================================================
    // INICIALIZA√á√ÉO
    // =======================================================

    document.addEventListener('DOMContentLoaded', function() {
        setGranularity('mensal');
    });

    function initDashboard() {
        const lojas = Array.isArray(JSON_VENDAS) ? JSON_VENDAS : [];
        const storeContainer = document.getElementById('storeList');
        storeContainer.innerHTML = '';

        if (lojas.length === 0) {
            showError("O JSON n√£o cont√©m uma lista de lojas v√°lida.");
            return;
        }

        lojas.sort((a, b) => (a.id_loja || 0) - (b.id_loja || 0));

        lojas.forEach((loja, idx) => {
            const btn = document.createElement('button');
            const id = String(loja.id_loja);
            const nomeLoja = NOMES_LOJAS[id] || `Loja ${id}`;
            btn.className = 'store-btn';
            btn.innerText = nomeLoja;
            btn.onclick = () => {
                ACTIVE_STORE = id;
                document.querySelectorAll('.store-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                updatePeriodSelect();
                processData();
            };
            storeContainer.appendChild(btn);
            if (idx === 0) {
                ACTIVE_STORE = id;
                btn.classList.add('active');
                updatePeriodSelect();
                processData();
            }
        });
    }

    function updatePeriodSelect() {
        const select = document.getElementById('periodSelect');
        select.innerHTML = '';

        const loja = JSON_VENDAS.find(l => String(l.id_loja) === String(ACTIVE_STORE));
        if (!loja || !loja.analises) return;

        const periodos = Object.keys(loja.analises).sort().reverse();

        periodos.forEach((p, i) => {
            const opt = document.createElement('option');
            opt.value = p;
            opt.textContent = formatPeriod(p);
            if (i === 0) opt.selected = true;
            select.appendChild(opt);
        });
    }

    // Fun√ß√£o para obter o primeiro dia (segunda-feira) de uma semana ISO
    function getWeekDates(ano, semana) {
        // Encontra a primeira quinta-feira do ano (define a semana 1 no padr√£o ISO)
        const jan4 = new Date(ano, 0, 4);
        const dayOfWeek = jan4.getDay() || 7; // Domingo = 7
        const firstMonday = new Date(jan4);
        firstMonday.setDate(jan4.getDate() - dayOfWeek + 1);

        // Calcula a segunda-feira da semana desejada
        const weekStart = new Date(firstMonday);
        weekStart.setDate(firstMonday.getDate() + (semana - 1) * 7);

        // Calcula o domingo (fim da semana)
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekStart.getDate() + 6);

        return { start: weekStart, end: weekEnd };
    }

    function formatPeriod(p) {
        if (p.includes('W')) {
            const [ano, semana] = p.split('-W');
            const { start, end } = getWeekDates(parseInt(ano), parseInt(semana));
            const startStr = start.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
            const endStr = end.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
            return `Semana ${semana} (${startStr} - ${endStr})`;
        }
        if (p.match(/^\d{4}-\d{2}-\d{2}$/)) {
            return new Date(p + 'T12:00:00').toLocaleDateString('pt-BR');
        }
        if (p.match(/^\d{4}-\d{2}$/)) {
            const [ano, mes] = p.split('-');
            const meses = ['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
            return `${meses[parseInt(mes)-1]}/${ano}`;
        }
        return p;
    }

    // =======================================================
    // PROCESSAMENTO DE DADOS
    // =======================================================

    function processData() {
        if (!JSON_VENDAS || !ACTIVE_STORE) return;

        const loja = JSON_VENDAS.find(l => String(l.id_loja) === String(ACTIVE_STORE));
        if (!loja || !loja.analises) return;

        const periodoSelecionado = document.getElementById('periodSelect').value;
        const dadosPeriodo = loja.analises[periodoSelecionado];

        if (!dadosPeriodo) return;

        const itens = dadosPeriodo.itens || [];
        const total = dadosPeriodo.total || 0;

        // Calcula curva ABC
        let produtosMap = {};
        let totalGeral = total;

        itens.forEach(item => {
            const nome = item.produto;
            const valor = item.valor || 0;
            if (!produtosMap[nome]) {
                produtosMap[nome] = { valor: 0, insights: [], tipo: item.tipo };
            }
            produtosMap[nome].valor += valor;
            if (item.analise_ia && item.analise_ia.diagnostico && item.analise_ia.diagnostico !== 'IA n√£o dispon√≠vel') {
                produtosMap[nome].insights.push({ texto: item.analise_ia.diagnostico, acao: item.analise_ia.acao });
            }
        });

        let todosProdutos = Object.entries(produtosMap)
            .map(([nome, dados]) => ({ nome, valor: dados.valor, insights: dados.insights, tipo: dados.tipo }))
            .sort((a, b) => b.valor - a.valor);

        // Calcula ABC
        let acum = 0;
        let countA = 0, countB = 0, countC = 0;
        let valorA = 0, valorB = 0, valorC = 0;

        todosProdutos = todosProdutos.map(p => {
            acum += p.valor;
            const pct = totalGeral > 0 ? (acum / totalGeral) : 0;
            let classe = 'C';
            if (pct <= 0.80) { classe = 'A'; countA++; valorA += p.valor; }
            else if (pct <= 0.95) { classe = 'B'; countB++; valorB += p.valor; }
            else { countC++; valorC += p.valor; }
            return { ...p, classe };
        });

        // Atualiza tela
        document.getElementById('totalFat').innerText = totalGeral.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        document.getElementById('totalItens').innerText = `${todosProdutos.length} produtos analisados`;

        // Salva estados
        window.currentProducts = todosProdutos;
        window.originalBestRanking = todosProdutos.filter(p => p.tipo === 'TOP').slice(0, 10);
        window.originalWorstRanking = todosProdutos.filter(p => p.tipo === 'BOTTOM').slice(0, 10);
        window.isFilteredByABC = false;

        // Renderiza
        renderChartHistory(loja.analises);
        renderABCChart(countA, countB, countC, valorA, valorB, valorC, totalGeral);
        renderList('listBest', window.originalBestRanking, 'success');
        renderList('listWorst', window.originalWorstRanking, 'danger');
        updateRestoreButtons();
        renderAllInsights(todosProdutos);
    }


    // =======================================================
    // RENDERIZA√á√ÉO
    // =======================================================

    function renderList(elementId, items, colorTheme) {
        const container = document.getElementById(elementId);
        container.innerHTML = '';
        if (items.length === 0) {
            container.innerHTML = '<div style="padding:10px; color:#94a3b8;">Sem dados para este per√≠odo.</div>';
            return;
        }
        items.forEach((item, index) => {
            const hasInsight = item.insights && item.insights.length > 0;
            const abcClass = item.classe === 'A' ? 'tag-a' : (item.classe === 'B' ? 'tag-b' : 'tag-c');
            container.innerHTML += `
                <div class="ranking-item">
                    <div class="item-rank">#${index+1}</div>
                    <div class="item-name">
                        <span class="abc-tag ${abcClass}">${item.classe}</span>
                        ${item.nome}
                        ${hasInsight ? '<span class="mini-tag">IA</span>' : ''}
                    </div>
                    <div class="item-val" style="color:var(--${colorTheme})">
                        ${item.valor.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}
                    </div>
                </div>`;
        });
    }

    function renderAllInsights(todosProdutos) {
        const container = document.getElementById('allInsightsContainer');
        const prods = todosProdutos.filter(p => p.insights && p.insights.length > 0);
        window.allInsightsProducts = prods;
        document.getElementById('insightCount').innerText = `${prods.length} encontrados`;
        displayInsights(prods);
    }

    function displayInsights(prods) {
        const container = document.getElementById('allInsightsContainer');
        if (prods.length === 0) {
            container.innerHTML = '<p style="color:#94a3b8; padding:20px; grid-column: 1/-1;">Nenhum insight dispon√≠vel para este per√≠odo.</p>';
            return;
        }
        container.innerHTML = prods.map(p => {
            const i = p.insights[0];
            const abcClass = p.classe === 'A' ? 'tag-a' : (p.classe === 'B' ? 'tag-b' : 'tag-c');
            return `<div class="insight-card">
                <div class="insight-prod"><span class="abc-tag ${abcClass}">${p.classe}</span>${p.nome}</div>
                <div class="insight-text">${i.texto}</div>
                ${i.acao && i.acao !== '-' ? `<div class="insight-action">üéØ ${i.acao}</div>` : ''}
            </div>`;
        }).join('');
    }

    function filterInsights() {
        const searchTerm = document.getElementById('searchInsights').value.toLowerCase().trim();
        if (!window.allInsightsProducts) return;

        if (!searchTerm) {
            displayInsights(window.allInsightsProducts);
            return;
        }

        const filtered = window.allInsightsProducts.filter(p => {
            const nomeMatch = p.nome.toLowerCase().includes(searchTerm);
            const textoMatch = p.insights.some(i => i.texto && i.texto.toLowerCase().includes(searchTerm));
            return nomeMatch || textoMatch;
        });
        displayInsights(filtered);
    }

    function renderChartHistory(analises) {
        const ctx = document.getElementById('chartHistory');
        if (chartInstance) chartInstance.destroy();

        const periodos = Object.keys(analises).sort();
        const valores = periodos.map(p => analises[p].total || 0);

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: periodos.map(formatPeriod),
                datasets: [{
                    label: 'Vendas (R$)',
                    data: valores,
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59,130,246,0.1)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true, ticks: { callback: v => 'R$ ' + v.toLocaleString('pt-BR') } } }
            }
        });
    }

    function renderABCChart(countA, countB, countC, valorA, valorB, valorC, totalGeral) {
        const ctx = document.getElementById('chartABC');
        if (chartABCInstance) chartABCInstance.destroy();
        if (countA + countB + countC === 0) return;

        const pctA = totalGeral > 0 ? Math.round((valorA / totalGeral) * 100) : 0;
        const pctB = totalGeral > 0 ? Math.round((valorB / totalGeral) * 100) : 0;
        const pctC = totalGeral > 0 ? Math.round((valorC / totalGeral) * 100) : 0;

        chartABCInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: [`A: ${countA} (${pctA}%)`, `B: ${countB} (${pctB}%)`, `C: ${countC} (${pctC}%)`],
                datasets: [{ data: [countA, countB, countC], backgroundColor: ['#10b981', '#f59e0b', '#ef4444'], borderWidth: 2, borderColor: '#ffffff' }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right', labels: { boxWidth: 12 } },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const index = context.dataIndex;
                                const valores = [valorA, valorB, valorC];
                                return `Valor: ${valores[index].toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;
                            }
                        }
                    }
                }
            }
        });

        // Clique no gr√°fico ABC para filtrar
        ctx.onclick = function(event) {
            const points = chartABCInstance.getElementsAtEventForMode(event, 'nearest', { intersect: true }, true);
            if (points.length > 0) {
                const index = points[0].index;
                const categorias = ['A', 'B', 'C'];
                const categoria = categorias[index];

                const todosProdutos = window.currentProducts || [];
                const produtosCategoria = todosProdutos.filter(p => p.classe === categoria);

                if (produtosCategoria.length > 0) {
                    const sorted = [...produtosCategoria].sort((a, b) => b.valor - a.valor);
                    renderList('listBest', sorted.slice(0, 10), 'success');
                    renderList('listWorst', [...sorted].filter(p => p.valor > 0).reverse().slice(0, 10), 'danger');
                    window.isFilteredByABC = true;
                    updateRestoreButtons();
                }
            }
        };
    }

    function updateRestoreButtons() {
        const display = window.isFilteredByABC ? 'inline-block' : 'none';
        const b1 = document.getElementById('btnRestoreBest');
        const b2 = document.getElementById('btnRestoreWorst');
        if (b1) b1.style.display = display;
        if (b2) b2.style.display = display;
    }

    function restoreRankings() {
        if (window.originalBestRanking) {
            renderList('listBest', window.originalBestRanking, 'success');
            renderList('listWorst', window.originalWorstRanking, 'danger');
            window.isFilteredByABC = false;
            updateRestoreButtons();
        }
    }
</script>
</body>
</html>

